<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Pakistan Cyber Security Challenge CTF - Cryptography Write-Up" /><meta name="author" content="wonderchild" /><meta property="og:locale" content="en" /><meta name="description" content="Hello folks, recently I participated in the 1st Pakistan Cyber Security Challenge CTF. My team secured 1st position in the qualifying round and came in 2nd place in the final round held at Air University, Islamabad. It was a wonderful experience, the challenges were well-designed, and Team AirOverflow is to be commended for their efforts." /><meta property="og:description" content="Hello folks, recently I participated in the 1st Pakistan Cyber Security Challenge CTF. My team secured 1st position in the qualifying round and came in 2nd place in the final round held at Air University, Islamabad. It was a wonderful experience, the challenges were well-designed, and Team AirOverflow is to be commended for their efforts." /><link rel="canonical" href="https://vonderchild.github.io/posts/PCC-Crypto/" /><meta property="og:url" content="https://vonderchild.github.io/posts/PCC-Crypto/" /><meta property="og:site_name" content="Saad Javed" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-08-04T17:30:00+05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Pakistan Cyber Security Challenge CTF - Cryptography Write-Up" /><meta name="twitter:site" content="@vonderchild" /><meta name="twitter:creator" content="@wonderchild" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"wonderchild"},"dateModified":"2023-03-30T18:12:20+05:00","datePublished":"2022-08-04T17:30:00+05:00","description":"Hello folks, recently I participated in the 1st Pakistan Cyber Security Challenge CTF. My team secured 1st position in the qualifying round and came in 2nd place in the final round held at Air University, Islamabad. It was a wonderful experience, the challenges were well-designed, and Team AirOverflow is to be commended for their efforts.","headline":"Pakistan Cyber Security Challenge CTF - Cryptography Write-Up","mainEntityOfPage":{"@type":"WebPage","@id":"https://vonderchild.github.io/posts/PCC-Crypto/"},"url":"https://vonderchild.github.io/posts/PCC-Crypto/"}</script><title>Pakistan Cyber Security Challenge CTF - Cryptography Write-Up | Saad Javed</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Saad Javed"><meta name="application-name" content="Saad Javed"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/avatar/avatar.png " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Saad Javed</a></div><div class="site-subtitle font-italic">A security engineer with interests in cryptography, web security, cloud security, and digital forensics.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/vonderchild" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/vonderchild" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/saadjawayd" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['saadjawayd','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Pakistan Cyber Security Challenge CTF - Cryptography Write-Up</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Pakistan Cyber Security Challenge CTF - Cryptography Write-Up</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/vonderchild">Saad Javed</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1659616200" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-08-04 </em> </span> <span> Updated <em class="timeago" data-ts="1680181940" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2023-03-30 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2055 words"> <em>11 min</em> read</span></div></div></div><div class="post-content"><p>Hello folks, recently I participated in the 1st Pakistan Cyber Security Challenge CTF. My team secured 1st position in the qualifying round and came in 2nd place in the final round held at Air University, Islamabad. It was a wonderful experience, the challenges were well-designed, and Team AirOverflow is to be commended for their efforts.</p><p>All of the cryptography challenges from the qualifier and final rounds will be discussed in detail in this write-up.</p><h1 id="qualifier-round">Qualifier Round</h1><h2 id="baquette"><span class="mr-2">Baquette</span><a href="#baquette" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><blockquote><p>The french make excellent cuisine. Well, even stronger encryption schemes. Do you really think you can fully eat this baquette?</p></blockquote><p>Key: auctf</p><blockquote></blockquote><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>Tbkl ns hqm doot hwdcptwy wkimel, kl nt?
Bkgy: Buux.
A2VmdVG3ZQzlNHxnuLwmKAqvxUUmcgWzh21hwpJlbRmzEnDrSB5kFiiGVOPNWnnkRCF1TZK0EXHhRCJfZ3Kmc3L5Z3wtZQ5hRrFtBPWfx2n0tK9ixZK0EXD9
</pre></table></code></div></div><p>The inclusion of the French in the challenge description suggests that this is the well-known Vigenere Cipher, since it was created in France. The key has been provided, so let’s open <a href="https://gchq.github.io/CyberChef/">CyberChef</a> and enter the ciphertext and key.</p><p><img data-src="/assets/img/posts/pcc-2022/crypto/vigenere1.png" alt="Vigenere1" data-proofer-ignore></p><p>The plaintext yields another ciphertext which appears to be base64 encoded, we can decode it using CyberChef.</p><p><img data-src="/assets/img/posts/pcc-2022/crypto/vigenere2.png" alt="Vigenere2" data-proofer-ignore></p><p>And we got the flag!</p><p>Flag: <code class="language-plaintext highlighter-rouge">AUCTF{baquettes_are_tasty_when_based_with_butter}</code></p><h2 id="climber"><span class="mr-2">Climber</span><a href="#climber" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><blockquote><p>Have you ever seen someone who is 7 feet tall, fencing on a 5-10 feet long railing? Well, me neither.</p></blockquote><p>t1_cfudrnu{0_ooathb_ths3z}1__zse</p><blockquote></blockquote><p>The Rail Fence Cipher is referenced in the challenge description, with <code class="language-plaintext highlighter-rouge">7</code> being the key and offset between <code class="language-plaintext highlighter-rouge">5</code> and <code class="language-plaintext highlighter-rouge">10</code>. So let’s test all five key-offset pairs on CyberChef. On <code class="language-plaintext highlighter-rouge">7</code> as key <code class="language-plaintext highlighter-rouge">9</code> as offset we obtain the correct plaintext.</p><p><img data-src="/assets/img/posts/pcc-2022/crypto/rail.png" alt="rail" data-proofer-ignore></p><p>Flag: <code class="language-plaintext highlighter-rouge">auctf{th1s_sh0u1d_b3_ezz_or_not}</code></p><h2 id="rsa"><span class="mr-2">RSA</span><a href="#rsa" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><h3 id="cipher"><span class="mr-2">Cipher</span><a href="#cipher" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>n = 31436211274852062801590948458671058204728701377920047195870016302697956796267506278727106968536534553505650010973423533569252216811398069950057574348601027314737123 
e = 65537 
c = 22840372395669361935504971154513566142872479734989306848229554805124371541157041389213350875178287707977731738003789623205786790284199917036685723196756139847839346
</pre></table></code></div></div><h3 id="solution"><span class="mr-2">Solution</span><a href="#solution" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>This is an RSA challenge, as the name implies. We are given the ciphertext <code class="language-plaintext highlighter-rouge">ct</code> as well as the public key <code class="language-plaintext highlighter-rouge">(n, e)</code>, where <code class="language-plaintext highlighter-rouge">n</code> is a product of two unknown primes <code class="language-plaintext highlighter-rouge">p</code> and <code class="language-plaintext highlighter-rouge">q</code> and <code class="language-plaintext highlighter-rouge">e</code> is the public exponent.</p><p>According to Wikipedia, the difficulty of dividing the modulus n into its prime parts p and q determines the security of RSA and as of 2020, the largest publicly known broken RSA key is RSA-250, which has <code class="language-plaintext highlighter-rouge">829</code> bits.</p><p>Meanwhile, the supplied n value is just <code class="language-plaintext highlighter-rouge">544</code> bits long and hence easily factorable. Let’s write a python script that factors <code class="language-plaintext highlighter-rouge">n</code> to <code class="language-plaintext highlighter-rouge">p</code> and <code class="language-plaintext highlighter-rouge">q</code>.</p><p><img data-src="/assets/img/posts/pcc-2022/crypto/factor.png" alt="Factor" data-proofer-ignore></p><p>Now that we have the values of <code class="language-plaintext highlighter-rouge">p</code> and <code class="language-plaintext highlighter-rouge">q</code>, the rest of the solution is basically textbook RSA, in which we compute the value of <code class="language-plaintext highlighter-rouge">phi</code> and then its private exponent <code class="language-plaintext highlighter-rouge">d</code> by:</p>\[phi = (p-1) \times (q - 1)\] \[d = e^{-1}\ mod\ phi\]<p><img data-src="/assets/img/posts/pcc-2022/crypto/phi_d.png" alt="phi_d" data-proofer-ignore></p><p>Finally, decrypt the ciphertext by computing</p>\[plaintext = c^d\ mod\ n\]<p><img data-src="/assets/img/posts/pcc-2022/crypto/pt.png" alt="Plaintext" data-proofer-ignore></p><p><strong>Code</strong></p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="n">sympy.ntheory</span> <span class="kn">import</span> <span class="n">factorint</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">31436211274852062801590948458671058204728701377920047195870016302697956796267506278727106968536534553505650010973423533569252216811398069950057574348601027314737123</span>
<span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<span class="n">c</span> <span class="o">=</span> <span class="mi">22840372395669361935504971154513566142872479734989306848229554805124371541157041389213350875178287707977731738003789623205786790284199917036685723196756139847839346</span>

<span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="nf">factorint</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="nf">inverse</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>

<span class="n">pt</span> <span class="o">=</span> <span class="nf">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">long_to_bytes</span><span class="p">(</span><span class="n">pt</span><span class="p">))</span>
</pre></table></code></div></div><p>Flag: <code class="language-plaintext highlighter-rouge">auctf{l4st_FLAG}</code></p><h2 id="kin"><span class="mr-2">Kin</span><a href="#kin" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><p>In this challenge, we are given an encryption function and a list of the decimal equivalents of the encrypted flag’s bytes.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">random</span>

<span class="n">flag</span> <span class="o">=</span> <span class="n">REDACTED</span>

<span class="k">def</span> <span class="nf">encrypt</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
  <span class="n">mod</span> <span class="o">=</span> <span class="mi">256</span>
  <span class="n">a</span> <span class="o">=</span> <span class="mi">203</span>
  <span class="n">b</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">mod</span><span class="p">)</span>
  <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
    <span class="n">enc</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="nf">ord</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">%</span> <span class="n">mod</span>
    <span class="n">res</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">enc</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">res</span>

<span class="nf">print</span><span class="p">(</span><span class="nf">encrypt</span><span class="p">(</span><span class="n">flag</span><span class="p">))</span>

<span class="c1"># flag = [152, 116, 46, 169, 143, 54, 152, 143, 143, 136, 231, 196, 2, 136, 222, 2, 99, 19, 30, 152, 134, 152, 99, 81, 196, 204]
</span></pre></table></code></div></div><p>It appears that the encryption function is akin to that of the Affine Cipher, hence the name <code class="language-plaintext highlighter-rouge">Kin</code>.</p><p>The encryption function for a single letter <code class="language-plaintext highlighter-rouge">x</code> in mathematical notation is</p>\[E(x)=(ax+b)\ mod\ m\]<p>where <code class="language-plaintext highlighter-rouge">a</code> and <code class="language-plaintext highlighter-rouge">b</code> are the keys, and <code class="language-plaintext highlighter-rouge">m</code> is the number of letters in the character set, which in ASCII is <code class="language-plaintext highlighter-rouge">256</code>. The values for <code class="language-plaintext highlighter-rouge">a</code> and <code class="language-plaintext highlighter-rouge">m</code> are known, but the value of <code class="language-plaintext highlighter-rouge">b</code> is picked at random from a range of <code class="language-plaintext highlighter-rouge">1...256</code>, which we can easily brute-force.</p><p>The decryption function for a single letter <code class="language-plaintext highlighter-rouge">x</code> is</p>\[D(x) = a^{-1}(x-b)\ mod\ m\]<p>where $a^{-1}$ is the modular multiplicative inverse of <code class="language-plaintext highlighter-rouge">a</code> modulo <code class="language-plaintext highlighter-rouge">m</code>. We can find its value using <code class="language-plaintext highlighter-rouge">invert</code> function from the <code class="language-plaintext highlighter-rouge">gmpy2</code> library.</p><p><img data-src="/assets/img/posts/pcc-2022/crypto/inverse.png" alt="Inverse" data-proofer-ignore></p><p>Let’s now write the decryption function and recover the plaintext.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">decryption</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span> <span class="c1"># brute-forcing the value for b
</span>        <span class="n">pt</span> <span class="o">=</span> <span class="s">""</span>
        <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">msg</span><span class="p">:</span>
            <span class="n">char</span> <span class="o">=</span> <span class="mi">227</span> <span class="o">*</span> <span class="p">(</span><span class="n">char</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">%</span> <span class="mi">256</span>
            <span class="n">pt</span> <span class="o">+=</span> <span class="nf">chr</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">"auctf"</span> <span class="ow">in</span> <span class="n">pt</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
            <span class="k">break</span>
</pre></table></code></div></div><p>Flag: <code class="language-plaintext highlighter-rouge">auctf{aff1ne_1s_br3akable}</code></p><h2 id="associative"><span class="mr-2">Associative</span><a href="#associative" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>What matters is if A==B then B==A.

CIPHER_TEXT = ExQNEAkWEwoLOV5HPBUVK3QQDEIRXwQEEw== KEY = cmFuZG9ta2V5Zm9yY3RmWERzZXZlbg==
</pre></table></code></div></div><h3 id="solution-1"><span class="mr-2">Solution</span><a href="#solution-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>The use of the word <code class="language-plaintext highlighter-rouge">Associative</code> and the suggestion of a one-to-one relation between <code class="language-plaintext highlighter-rouge">A</code> and <code class="language-plaintext highlighter-rouge">B</code> indicate that plaintext is subjected to a straightforward XOR operation. Because XOR is associative, if $a \oplus b = c$, then $b \oplus c = a$, and similarly $a \oplus c = b$.</p><p>Both the ciphertext and the key were encoded using base64, therefore we must first decode them to their original byte form before recovering the plaintext by conducting a bitwise XOR operation on the ciphertext and key.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="n">base64</span>

<span class="n">CIPHER_TEXT</span> <span class="o">=</span> <span class="s">"ExQNEAkWEwoLOV5HPBUVK3QQDEIRXwQEEw=="</span>
<span class="n">KEY</span> <span class="o">=</span> <span class="s">"cmFuZG9ta2V5Zm9yY3RmWERzZXZlbg=="</span>

<span class="n">cipher_text</span> <span class="o">=</span> <span class="n">base64</span><span class="p">.</span><span class="nf">b64decode</span><span class="p">(</span><span class="n">CIPHER_TEXT</span><span class="p">)</span>
<span class="n">key</span> <span class="o">=</span> <span class="n">base64</span><span class="p">.</span><span class="nf">b64decode</span><span class="p">(</span><span class="n">KEY</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="nf">xor</span><span class="p">(</span><span class="n">cipher_text</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span>
</pre></table></code></div></div><p>Flag: <code class="language-plaintext highlighter-rouge">auctf{xor_15_ass0ci4t1ve}</code></p><h1 id="final-round">Final Round</h1><h2 id="write34"><span class="mr-2">Write34</span><a href="#write34" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="n">flag</span> <span class="o">=</span> <span class="n">flag</span><span class="p">.</span><span class="nf">encode</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="n">base64</span><span class="p">.</span><span class="nf">b16encode</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="n">base64</span><span class="p">.</span><span class="nf">b32encode</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="n">base64</span><span class="p">.</span><span class="nf">b64encode</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>

<span class="n">fernet</span> <span class="o">=</span> <span class="nc">Fernet</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="n">fernet</span><span class="p">.</span><span class="nf">encrypt</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="n">binascii</span><span class="p">.</span><span class="nf">hexlify</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</pre></table></code></div></div><p><strong>Attachments:</strong></p><p><a href="/assets/files/pcc-2022/crypto/key.txt">key.txt</a></p><p><a href="/assets/files/pcc-2022/crypto/code.txt">code.txt</a></p><p><a href="/assets/files/pcc-2022/crypto/cipher.txt">cipher.txt</a></p><p>For this challenge, we’re provided with a custom encryption algorithm that first encodes the flag three times using base16, base32, and base64. The algorithm then utilizes fernet to encrypt the flag three times, and finally, and the flag is then converted to hex three times.</p><p>The solution is fairly simple, all that needs to be done to recover the plaintext is to reverse the algorithm since we already know the key and the ciphertext.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">binascii</span> <span class="kn">import</span> <span class="n">unhexlify</span>
<span class="kn">from</span> <span class="n">cryptography.fernet</span> <span class="kn">import</span> <span class="n">Fernet</span>
<span class="kn">import</span> <span class="n">base64</span>

<span class="n">flag</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="s">"flag.txt"</span><span class="p">).</span><span class="nf">read</span><span class="p">()</span>
<span class="n">key</span> <span class="o">=</span> <span class="s">"YntAd4Y6MNT0uRgfsHnagRPXux7Hgs0lwIjKbrd8MbQ="</span>
<span class="n">fernet</span> <span class="o">=</span> <span class="nc">Fernet</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="nf">unhexlify</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="n">fernet</span><span class="p">.</span><span class="nf">decrypt</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="n">base64</span><span class="p">.</span><span class="nf">b64decode</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="n">base64</span><span class="p">.</span><span class="nf">b32decode</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="n">base64</span><span class="p">.</span><span class="nf">b16decode</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</pre></table></code></div></div><p>Flag: <code class="language-plaintext highlighter-rouge">AUCTF{suCh_3nc0d1ng_muCh_fl4g_w0w}</code></p><h2 id="biggie-small-d"><span class="mr-2">BiggiE small :D</span><a href="#biggie-small-d" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><blockquote><p>Last time our RSA encryption was weak, a mathematician suggested to increase the exponent, because more bits makes it more secure.</p></blockquote><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>n: 609983533322177402468580314139090006939877955334245068261469677806169434040069069770928535701086364941983428090933795745853896746458472620457491993499511798536747668197186857850887990812746855062415626715645223089415186093589721763366994454776521466115355580659841153428179997121984448771910872629371808169183
e: 387825392787200906676631198961098070912332865442137539919413714790310139653713077586557654409565459752133439009280843965856789151962860193830258244424149230046832475959852771134503754778007132465468717789936602755336332984790622132641288576440161244396963980583318569320681953570111708877198371377792396775817
</pre></table></code></div></div><p><strong>Attachments:</strong></p><p><a href="/assets/files/pcc-2022/crypto/flag.enc">flag.enc</a></p><p>It is an RSA challenge, and the description suggests that a big public exponent is used. Looking at the public key, it can be seen that the value of <code class="language-plaintext highlighter-rouge">e</code> is too big, which is unusual. A quick google search reveals that having an unusually big value for the public exponent results in a small value for the private exponent <code class="language-plaintext highlighter-rouge">d</code>, which makes RSA prone to Weiner’s Attack. Read in detail from <a href="https://crypto.stanford.edu/~dabo/papers/RSA-survey.pdf">Twenty Years of Attacks on the RSA Cryptosystem</a>.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span> <span class="nf">wiener</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="c1"># Convert e/n into a continued fraction
</span>    <span class="n">cf</span> <span class="o">=</span> <span class="nf">continued_fraction</span><span class="p">(</span><span class="n">e</span><span class="o">/</span><span class="n">n</span><span class="p">)</span>
    <span class="n">convergents</span> <span class="o">=</span> <span class="n">cf</span><span class="p">.</span><span class="nf">convergents</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">kd</span> <span class="ow">in</span> <span class="n">convergents</span><span class="p">:</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">kd</span><span class="p">.</span><span class="nf">numerator</span><span class="p">()</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">kd</span><span class="p">.</span><span class="nf">denominator</span><span class="p">()</span>
        <span class="c1"># Check if k and d meet the requirements
</span>        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">d</span><span class="o">%</span><span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">e</span><span class="o">*</span><span class="n">d</span> <span class="o">%</span> <span class="n">k</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">e</span><span class="o">*</span><span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">k</span>
        <span class="c1"># Create the polynomial
</span>        <span class="n">x</span> <span class="o">=</span> <span class="nc">PolynomialRing</span><span class="p">(</span><span class="nc">RationalField</span><span class="p">(),</span> <span class="s">'x'</span><span class="p">).</span><span class="nf">gen</span><span class="p">()</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">x</span><span class="o">^</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">phi</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">n</span>
        <span class="n">roots</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="nf">roots</span><span class="p">()</span>
        <span class="c1"># Check if polynomial as two roots
</span>        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">roots</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="c1"># Check if roots of the polynomial are p and q
</span>        <span class="n">p</span><span class="p">,</span><span class="n">q</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">roots</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="nf">int</span><span class="p">(</span><span class="n">roots</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">*</span><span class="n">q</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">d</span>
    <span class="k">return</span> <span class="bp">None</span>

<span class="c1"># Test to see if our attack works
</span><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">609983533322177402468580314139090006939877955334245068261469677806169434040069069770928535701086364941983428090933795745853896746458472620457491993499511798536747668197186857850887990812746855062415626715645223089415186093589721763366994454776521466115355580659841153428179997121984448771910872629371808169183</span>
    <span class="n">e</span> <span class="o">=</span> <span class="mi">387825392787200906676631198961098070912332865442137539919413714790310139653713077586557654409565459752133439009280843965856789151962860193830258244424149230046832475959852771134503754778007132465468717789936602755336332984790622132641288576440161244396963980583318569320681953570111708877198371377792396775817</span>
    <span class="n">d</span> <span class="o">=</span> <span class="nf">wiener</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
    
    <span class="n">c_bytes</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="s">"flag.enc"</span><span class="p">,</span> <span class="s">"rb"</span><span class="p">).</span><span class="nf">read</span><span class="p">()</span>
    <span class="n">c</span> <span class="o">=</span> <span class="nf">bytes_to_long</span><span class="p">(</span><span class="n">c_bytes</span><span class="p">)</span>
    
    <span class="n">pt</span> <span class="o">=</span> <span class="nf">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="nf">long_to_bytes</span><span class="p">(</span><span class="nf">int</span><span class="p">(</span><span class="n">pt</span><span class="p">)))</span>
</pre></table></code></div></div><p>Flag: <code class="language-plaintext highlighter-rouge">auctf{huge_e_small_d_and_wiener_attack}</code></p><p>We can mark the challenge as solved here. However, there’s another, unintended way to solve this challenge. The modulus used by the challenge author is quite old, and can easily be factorized into <code class="language-plaintext highlighter-rouge">p</code> and <code class="language-plaintext highlighter-rouge">q</code> using <a href="http://factordb.com">factordb.com</a>.</p><p><img data-src="/assets/img/posts/pcc-2022/crypto/factordb.png" alt="Factordb" data-proofer-ignore></p><p>Rest is textbook RSA, we can simply follow the same steps as we did in the RSA challenge from the qualifier round. However, the <code class="language-plaintext highlighter-rouge">flag.enc</code> consists of bytes rather than long integer this time, so we will use the <code class="language-plaintext highlighter-rouge">bytes_to_long</code> function of <code class="language-plaintext highlighter-rouge">pycryptodome</code> library to convert the ciphertext to a long integer.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">609983533322177402468580314139090006939877955334245068261469677806169434040069069770928535701086364941983428090933795745853896746458472620457491993499511798536747668197186857850887990812746855062415626715645223089415186093589721763366994454776521466115355580659841153428179997121984448771910872629371808169183</span>
<span class="n">e</span> <span class="o">=</span> <span class="mi">387825392787200906676631198961098070912332865442137539919413714790310139653713077586557654409565459752133439009280843965856789151962860193830258244424149230046832475959852771134503754778007132465468717789936602755336332984790622132641288576440161244396963980583318569320681953570111708877198371377792396775817</span>

<span class="n">flag</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="s">"flag.enc"</span><span class="p">,</span> <span class="s">"rb"</span><span class="p">).</span><span class="nf">read</span><span class="p">()</span>

<span class="n">ct</span> <span class="o">=</span> <span class="nf">bytes_to_long</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>

<span class="c1"># from factordb
</span><span class="n">p</span> <span class="o">=</span> <span class="mi">22107961593273663554447672179167919592270857343971618325649212520279122827566022270428817505638791153667398184068987608971763363269212331920067006335889541</span>
<span class="n">q</span> <span class="o">=</span> <span class="mi">27591125068163886831989228774178759832120484388897183929367433612315983402979538404952530012269465045393978140179601040530392691765067542341015115680614163</span>

<span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">d</span> <span class="o">=</span> <span class="nf">inverse</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>

<span class="n">pt</span> <span class="o">=</span> <span class="nf">pow</span><span class="p">(</span><span class="n">ct</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="nf">long_to_bytes</span><span class="p">(</span><span class="n">pt</span><span class="p">))</span>
</pre></table></code></div></div><p>Flag: <code class="language-plaintext highlighter-rouge">auctf{huge_e_small_d_and_wiener_attack}</code></p><h2 id="555"><span class="mr-2">555</span><a href="#555" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">random</span>
<span class="kn">from</span> <span class="n">Crypto.Util.number</span> <span class="kn">import</span> <span class="n">long_to_bytes</span>
<span class="kn">from</span> <span class="n">Crypto.Cipher</span> <span class="kn">import</span> <span class="n">AES</span>
<span class="kn">from</span> <span class="n">Crypto.Util.Padding</span> <span class="kn">import</span> <span class="n">pad</span>

<span class="n">bits</span> <span class="o">=</span> <span class="mi">128</span>
<span class="n">shares</span> <span class="o">=</span> <span class="mi">30</span>

<span class="c1">## pardon my bad coding practices
## improvise adapt dryrun
</span>
<span class="k">def</span> <span class="nf">encrypt</span><span class="p">(</span><span class="n">flag</span><span class="p">):</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="nf">randbytes</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">cipher</span> <span class="o">=</span> <span class="n">AES</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">AES</span><span class="p">.</span><span class="n">MODE_ECB</span><span class="p">)</span>
    <span class="n">enc_flag</span> <span class="o">=</span> <span class="n">cipher</span><span class="p">.</span><span class="nf">encrypt</span><span class="p">(</span><span class="nf">pad</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="s">"flag4.enc"</span><span class="p">,</span> <span class="s">"w"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">enc_flag</span><span class="p">.</span><span class="nf">hex</span><span class="p">()</span>

<span class="n">poly</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="p">.</span><span class="nf">getrandbits</span><span class="p">(</span><span class="n">bits</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">shares</span><span class="p">)]</span>
<span class="n">flag</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="s">"./flag4.txt"</span><span class="p">,</span> <span class="s">"rb"</span><span class="p">).</span><span class="nf">read</span><span class="p">()</span>

<span class="n">random</span><span class="p">.</span><span class="nf">seed</span><span class="p">(</span><span class="n">poly</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">encrypt</span><span class="p">(</span><span class="n">flag</span><span class="p">))</span>

<span class="n">x</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="nf">input</span><span class="p">(</span><span class="s">"input x: "</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">sum</span><span class="p">(</span><span class="nf">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">poly</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="nf">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">poly</span><span class="p">)))))</span>
</pre></table></code></div></div><p>We are provided with a Python code that generates a random array of size <code class="language-plaintext highlighter-rouge">30</code>, then uses the first element as a seed to the random function. The encryption function is then called, which produces a random key and encrypts the flag with AES.</p><p>I was unable to solve this challenge during the event, since the challenge required some time to tinker with it, and an understanding of positional number system. And I lacked both 🤡.</p><p>The encryption function is straightforward. AES with ECB mode is used, and a random key of <code class="language-plaintext highlighter-rouge">16</code> bytes is created. Line 22 shows the usage of a seed <code class="language-plaintext highlighter-rouge">poly[0]</code>, which is also generated randomly. The usage of seed ensures that the random function generates the same random integers each time it is run. Once we retrieve the seed’s value, solving this challenge will be a piece of cake.</p><p>The program takes input the value of <code class="language-plaintext highlighter-rouge">x</code> on line 25 and then, on line 26, loops over the elements of the list <code class="language-plaintext highlighter-rouge">poly</code> and sums the product of values on each index of <code class="language-plaintext highlighter-rouge">poly</code> array with $x^i$ where <code class="language-plaintext highlighter-rouge">i</code> is the iterator.</p><p>The last line of code can also be expressed as:</p>\[\sum_{i=0}^{29} poly_{i} \times x^i\]<p>Or in python:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">poly</span><span class="p">)):</span>
  <span class="n">s</span> <span class="o">+=</span> <span class="n">poly</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="nf">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></table></code></div></div><p>We need to extract <code class="language-plaintext highlighter-rouge">poly[0]</code> from the sum. We know that any base to the power <code class="language-plaintext highlighter-rouge">0</code> is <code class="language-plaintext highlighter-rouge">1</code> e.g.: \(2^0 = 1\) , and similarly \(0^0 = 1\) .</p><p>If we enter <code class="language-plaintext highlighter-rouge">x</code> as <code class="language-plaintext highlighter-rouge">0</code>, we can trick the program into doing</p>\[\sum_{i=0}^{29} poly_{i} \times 0^i\]<p>For all iterations except \(i=0\), the result of the product will be <code class="language-plaintext highlighter-rouge">0</code>. In case of \(i = 0\), the right hand side of the product will become <code class="language-plaintext highlighter-rouge">1</code> and the product will be equal to <code class="language-plaintext highlighter-rouge">poly[i]</code>. This will only be true because</p>\[poly_0 \times 0^0 = poly_0 \times 1 = poly_0\]<p>Hence, the sum will be equal to <code class="language-plaintext highlighter-rouge">poly[0]</code>. Now we can simply use it as a seed to generate our key and decrypt the flag.</p><p><img data-src="/assets/img/posts/pcc-2022/crypto/seed.png" alt="Seed" data-proofer-ignore></p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">Crypto.Cipher</span> <span class="kn">import</span> <span class="n">AES</span>
<span class="kn">import</span> <span class="n">random</span>

<span class="n">enc_flag</span> <span class="o">=</span> <span class="s">"f79beca540b155be28b83c8b871640888766c70b82670f2cde28c40976d46fc7"</span>
<span class="n">flag_bytes</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">.</span><span class="nf">fromhex</span><span class="p">(</span><span class="n">enc_flag</span><span class="p">)</span>

<span class="n">seed</span> <span class="o">=</span> <span class="mi">270882600965622237109048171195266900279</span> <span class="c1"># poly[0] or the sum when x is 0
</span><span class="n">random</span><span class="p">.</span><span class="nf">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

<span class="n">key</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="nf">randbytes</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
<span class="n">cipher</span> <span class="o">=</span> <span class="n">AES</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">AES</span><span class="p">.</span><span class="n">MODE_ECB</span><span class="p">)</span>
<span class="n">dec_flag</span> <span class="o">=</span> <span class="n">cipher</span><span class="p">.</span><span class="nf">decrypt</span><span class="p">(</span><span class="n">flag_bytes</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="n">dec_flag</span><span class="p">)</span>
</pre></table></code></div></div><p>Flag: <code class="language-plaintext highlighter-rouge">auctf{hash3lizer_ust@@d_&lt;3}</code></p><p>Mathematics, Cryptography, Magic, Mystery, Beauty. That’s all Folks. Have a great day!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/pcc/'>PCC</a>, <a href='/categories/crypto/'>Crypto</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ctf/" class="post-tag no-text-decoration" >CTF</a> <a href="/tags/crypto/" class="post-tag no-text-decoration" >crypto</a> <a href="/tags/pcc/" class="post-tag no-text-decoration" >PCC</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Pakistan Cyber Security Challenge CTF - Cryptography Write-Up - Saad Javed&amp;url=https://vonderchild.github.io/posts/PCC-Crypto/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Pakistan Cyber Security Challenge CTF - Cryptography Write-Up - Saad Javed&amp;u=https://vonderchild.github.io/posts/PCC-Crypto/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://vonderchild.github.io/posts/PCC-Crypto/&amp;text=Pakistan Cyber Security Challenge CTF - Cryptography Write-Up - Saad Javed" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/DeconstruCT.F-Doe-A-Deer/">Doe, a deer — DeconstruCT.F 2021</a><li><a href="/posts/PCC-Crypto/">Pakistan Cyber Security Challenge CTF - Cryptography Write-Up</a><li><a href="/posts/National-Hackathon-2022/">National Cyber Security Hackathon 2022 — Cryptography Write Up</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/crypto/">crypto</a> <a class="post-tag" href="/tags/ctf/">CTF</a> <a class="post-tag" href="/tags/containers/">Containers</a> <a class="post-tag" href="/tags/hackathon/">Hackathon</a> <a class="post-tag" href="/tags/pcc/">PCC</a> <a class="post-tag" href="/tags/security/">Security</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/National-Hackathon-2022/"><div class="card-body"> <em class="timeago small" data-ts="1671990000" > 2022-12-25 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>National Cyber Security Hackathon 2022 — Cryptography Write Up</h3><div class="text-muted small"><p> There’s a saying that gets thrown around a lot in the cybersecurity community, “Never roll your own crypto”, which refers to the idea that it is generally not recommended to create your own crypt...</p></div></div></a></div><div class="card"> <a href="/posts/DeconstruCT.F-Doe-A-Deer/"><div class="card-body"> <em class="timeago small" data-ts="1633173600" > 2021-10-02 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Doe, a deer — DeconstruCT.F 2021</h3><div class="text-muted small"><p> Last week, my team and I took part in DeconstruCT.F, a 24-hour Capture The Flag event organized by the Google Developers Student Club at Vellore Institute of Technology. It was an exciting compet...</p></div></div></a></div><div class="card"> <a href="/posts/containers-running-as-root/"><div class="card-body"> <em class="timeago small" data-ts="1679823000" > 2023-03-26 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>The False Sense of Security: Running Containers as root</h3><div class="text-muted small"><p> Containers have revolutionized modern software development, enabling us to develop, build, package, and deploy software applications faster and more efficiently than ever before. The benefits of ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/DeconstruCT.F-Doe-A-Deer/" class="btn btn-outline-primary" prompt="Older"><p>Doe, a deer — DeconstruCT.F 2021</p></a> <a href="/posts/National-Hackathon-2022/" class="btn btn-outline-primary" prompt="Newer"><p>National Cyber Security Hackathon 2022 — Cryptography Write Up</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/vonderchild">Saad Javed</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/crypto/">crypto</a> <a class="post-tag" href="/tags/ctf/">CTF</a> <a class="post-tag" href="/tags/containers/">Containers</a> <a class="post-tag" href="/tags/hackathon/">Hackathon</a> <a class="post-tag" href="/tags/pcc/">PCC</a> <a class="post-tag" href="/tags/security/">Security</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-KY7H42WSKR"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-KY7H42WSKR'); }); </script>
